dolmen.forms.table
==================

Test initialization
-------------------

  >>> from dolmen.forms.base import testing
  >>> testing.grok('dolmen.forms.table')

Lines
-----

A table form can work on more than one item. For this we need an
object which have values. A dictionnary is a good example:

  >>> class Person(object):
  ...     def __init__(self, name, age):
  ...         self.name = name
  ...         self.age = age

  >>> content = {
  ...    'Paul': Person('Paul', 42),
  ...    'Arthur': Person('Arthur', 24),
  ...    'Merlin': Person('Merlin', 203412)}

  >>> from dolmen.forms.table import TableForm
  >>> from cromlech.browser.testing import TestHTTPRequest
  >>> from zope.interface.verify import verifyObject

  >>> request = TestHTTPRequest()
  >>> form = TableForm(content, request)

  >>> from dolmen.forms.table.interfaces import ITableForm
  >>> verifyObject(ITableForm, form)
  True

Table ``getItems`` should give access to form values. **The order of
the elements returned by ``getItems`` should be stable between two
calls**.

This is used by ``updateLines`` to create widgets for all lines. Those
are have a line prefix:

  >>> len(form.getItems())
  3

  >>> form.updateLines()
  >>> len(form.lines)
  3
  >>> [line.prefix for line in form.lines]
  ['form.line-0', 'form.line-1', 'form.line-2']
  >>> len(form.lineWidgets)
  3

The table has a batching capabilities by default, that has to be activated.

  >>> form = TableForm(content, request)
  >>> form.createBatch = True

To be able to compute the URL, we need to define a publication root::

  >>> from cromlech.io import IPublicationRoot
  >>> from zope.interface import directlyProvides
  >>> directlyProvides(form, IPublicationRoot)

Now, we can render the batch::

  >>> form.batchSize = 1
  >>> form.update()
  >>> print form.batcher.size
  1
  >>> print form.batcher.url 
  http://localhost
